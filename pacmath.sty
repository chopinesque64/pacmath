\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{pacmath}[2019-08-03 Pacmath]

\RequirePackage{amsmath}
\RequirePackage{pict2e}

\makeatletter

% Internal structure.
\@ifdefinable\if@pac@eye@{\newif\if@pac@eye@}
\@ifdefinable\if@pac@mouth@{\newif\if@pac@mouth@}

% Drawing macros.
% Arguments: #1 -- font style
%            #2 -- line thickness
%            #3 -- eye diameter

%%% Small Pacman %%%
\def\@pac@Small@man@X{1.305}
\def\@pac@Small@man@Y{0.80}
\def\@pac@Small@man@T{1.5}
\def\@pac@Small@man@regionA@control@X{0.6525}
\def\@pac@Small@man@regionA@control@Y{0.375}
\def\@pac@Small@man@regionB@control@X{0.87}
\def\@pac@Small@man@regionB@control@Y{1.5}
\def\@pac@Small@man@regionC@control@X{1.725}
\def\@pac@Small@man@regionC@control@Y{0}
\def\@pac@Small@man@eye@X{0.15}
\def\@pac@Small@man@eye@Y{0.80}

\newcommand*\@pac@Small@man[3]{%
    \setlength\unitlength{\fontdimen 22 #1\tw@}%
    \vrule \@width\z@ \@height\z@ \@depth\@ne\unitlength%
    \begin{picture}(2.75,2.85)(-1.35,-1.)
        \linethickness{#2\p@}%
        \qbezier(0, 0)(\@pac@Small@man@regionA@control@X, \@pac@Small@man@regionA@control@Y)(\@pac@Small@man@X, \@pac@Small@man@Y)%
        \qbezier(\@pac@Small@man@X, \@pac@Small@man@Y)(\@pac@Small@man@regionB@control@X, \@pac@Small@man@regionB@control@Y)(0, \@pac@Small@man@T)%
        \qbezier(0, \@pac@Small@man@T)(-\@pac@Small@man@regionB@control@X, \@pac@Small@man@regionB@control@Y)(-\@pac@Small@man@X, \@pac@Small@man@Y)%
        \qbezier(-\@pac@Small@man@X, \@pac@Small@man@Y)(-\@pac@Small@man@regionC@control@X, 0)(-\@pac@Small@man@X, -\@pac@Small@man@Y)%
        \qbezier(-\@pac@Small@man@X, -\@pac@Small@man@Y)(-\@pac@Small@man@regionB@control@X, -\@pac@Small@man@regionB@control@Y)(0, -\@pac@Small@man@T)%
        \qbezier(0, -\@pac@Small@man@T)(\@pac@Small@man@regionB@control@X, -\@pac@Small@man@regionB@control@Y)(\@pac@Small@man@X, -\@pac@Small@man@Y)%
        \qbezier(\@pac@Small@man@X, -\@pac@Small@man@Y)(\@pac@Small@man@regionA@control@X, -\@pac@Small@man@regionA@control@Y)(0, 0)%
        \if@pac@eye@
            \put(\@pac@Small@man@eye@X, \@pac@Small@man@eye@Y){\circle*{#3}}%
        \fi
    \end{picture}
}


%%% Small Ghost %%%
\def\@pac@Small@ghost@body@height{3}
\def\@pac@Small@ghost@body@arc@X{1.5}
\def\@pac@Small@ghost@body@arc@Y{4.5}
\def\@pac@Small@ghost@eyeL@X{2.125}
\def\@pac@Small@ghost@eyeR@X{1.2}
\def\@pac@Small@ghost@eye@Y{2.25}

\def\@pac@Small@ghost@cloth@outer@control@Y{0.4}
\def\@pac@Small@ghost@cloth@inner@control@Y{0.4}

\def\@pac@Small@ghost@clothA@X{0.5}
\def\@pac@Small@ghost@clothA@Y{0.7}
\def\@pac@Small@ghost@clothA@control@X{.125}

\def\@pac@Small@ghost@clothB@X{1}
\def\@pac@Small@ghost@clothB@control@X{0.75}

\def\@pac@Small@ghost@clothC@X{1.5}
\def\@pac@Small@ghost@clothC@Y{0.7}
\def\@pac@Small@ghost@clothC@control@X{1.25}

\def\@pac@Small@ghost@clothD@X{2}
\def\@pac@Small@ghost@clothD@control@X{1.75}

\def\@pac@Small@ghost@clothE@X{2.5}
\def\@pac@Small@ghost@clothE@Y{0.7}
\def\@pac@Small@ghost@clothE@control@X{2.2}

\def\@pac@Small@ghost@clothF@X{3}
\def\@pac@Small@ghost@clothF@control@X{2.875}

\newcommand*\@pac@Small@ghost[3]{%
    \setlength\unitlength{\fontdimen 22 #1\tw@}%
    \vrule \@width\z@ \@height\z@ \@depth\@ne\unitlength%
    \begin{picture}(3.6,3.6)(-0.2,.45)
        \linethickness{#2\p@}%
        \put(0, 0){\line(0, \@pac@Small@ghost@body@height){\@pac@Small@ghost@body@height}}
        \qbezier(0, \@pac@Small@ghost@body@height)(\@pac@Small@ghost@body@arc@X, \@pac@Small@ghost@body@arc@Y)(\@pac@Small@ghost@body@height, \@pac@Small@ghost@body@height)
        \put(\@pac@Small@ghost@body@height, 0){\line(0, \@pac@Small@ghost@body@height){\@pac@Small@ghost@body@height}}
        \qbezier(0,0)(\@pac@Small@ghost@clothA@control@X, \@pac@Small@ghost@cloth@outer@control@Y)(\@pac@Small@ghost@clothA@X, \@pac@Small@ghost@clothA@Y)
        \qbezier(\@pac@Small@ghost@clothA@X, \@pac@Small@ghost@clothA@Y)(\@pac@Small@ghost@clothB@control@X, \@pac@Small@ghost@cloth@inner@control@Y)(\@pac@Small@ghost@clothB@X, 0)
        \qbezier(\@pac@Small@ghost@clothB@X, 0)(\@pac@Small@ghost@clothC@control@X, \@pac@Small@ghost@cloth@inner@control@Y)(\@pac@Small@ghost@clothC@X, \@pac@Small@ghost@clothC@Y)
        \qbezier(\@pac@Small@ghost@clothC@X, \@pac@Small@ghost@clothC@Y)(\@pac@Small@ghost@clothD@control@X, \@pac@Small@ghost@cloth@inner@control@Y)(\@pac@Small@ghost@clothD@X, 0)
        \qbezier(\@pac@Small@ghost@clothD@X, 0)(\@pac@Small@ghost@clothE@control@X,\@pac@Small@ghost@cloth@inner@control@Y)(\@pac@Small@ghost@clothE@X, \@pac@Small@ghost@clothE@Y)
        \qbezier(\@pac@Small@ghost@clothE@X, \@pac@Small@ghost@clothE@Y)(\@pac@Small@ghost@clothF@control@X, \@pac@Small@ghost@cloth@outer@control@Y)(\@pac@Small@ghost@clothF@X, 0)
        \if@pac@eye@
            \put(\@pac@Small@ghost@eyeL@X, \@pac@Small@ghost@eye@Y){\circle*{#3}}
            \put(\@pac@Small@ghost@eyeR@X, \@pac@Small@ghost@eye@Y){\circle*{#3}}
        \fi
    \end{picture}
}


% Math mode verification.
\newcommand*\@pac@if@bold@math{%
    \def\@tempa{bold}%
    \ifx\math@version\@tempa
        \expandafter\@firstoftwo
    \else
        \expandafter\@secondoftwo
    \fi
}

% Mode-selection backend.
\def\@pac@Large@bold@textfont@thickness{0.95}
\def\@pac@Large@bold@textfont@eye{}
\def\@pac@Small@bold@textfont@thickness{0.60}
\def\@pac@Small@bold@textfont@eye{0.45}
\def\@pac@Small@bold@scriptfont@thickness{0.2}
\def\@pac@Small@bold@scriptfont@eye{0.01}
\def\@pac@Small@bold@sscriptfont@thickness{0.01}
\def\@pac@Small@bold@sscriptfont@eye{0}

\def\@pac@Small@textfont@thickness{0.4}
\def\@pac@Small@textfont@eye{0.45}
\def\@pac@Small@scriptfont@thickness{0.2}
\def\@pac@Small@scriptfont@eye{0.4}
\def\@pac@Small@sscriptfont@thickness{0.01}
\def\@pac@Small@sscriptfont@eye{0.2}

\newcommand*\@pac@mathman{%
    \mathop{%
        \@pac@if@bold@math{%
            \mathchoice{%
                \@pac@Small@man \textfont {\@pac@Small@bold@textfont@thickness}{\@pac@Small@bold@textfont@eye}%
            }{%
                \@pac@Small@man \textfont {\@pac@Small@bold@textfont@thickness}{\@pac@Small@bold@textfont@eye}%
            }{%
                \@pac@Small@man \scriptfont {\@pac@Small@bold@scriptfont@thickness}{\@pac@Small@bold@scriptfont@eye}%
            }{%
                \@pac@Small@man \scriptscriptfont {\@pac@Small@bold@sscriptfont@thickness}{\@pac@Small@bold@sscriptfont@eye}%
            }%
        }{%
            \mathchoice{%
                \@pac@Small@man \textfont {\@pac@Small@textfont@thickness}{\@pac@Small@textfont@eye}%
            }{%
                \@pac@Small@man \textfont {\@pac@Small@textfont@thickness}{\@pac@Small@textfont@eye}%
            }{%
                \@pac@Small@man \scriptfont {\@pac@Small@scriptfont@thickness}{\@pac@Small@scriptfont@eye}%
            }{%
                \@pac@Small@man \scriptscriptfont {\@pac@Small@sscriptfont@thickness}{\@pac@Small@sscriptfont@eye}%
            }%
        }%
    }% \displaylimits % as per default
}

\newcommand*\@pac@mathghost{%
    \mathop{%
        \@pac@if@bold@math{%
            \mathchoice{%
                \@pac@Small@ghost \textfont {\@pac@Small@bold@textfont@thickness}{\@pac@Small@bold@textfont@eye}%
            }{%
                \@pac@Small@ghost \textfont {\@pac@Small@bold@textfont@thickness}{\@pac@Small@bold@textfont@eye}%
            }{%
                \@pac@Small@ghost \scriptfont {\@pac@Small@bold@scriptfont@thickness}{\@pac@Small@bold@scriptfont@eye}%
            }{%
                \@pac@Small@ghost \scriptscriptfont {\@pac@Small@bold@sscriptfont@thickness}{\@pac@Small@bold@sscriptfont@eye}%
            }%
        }{%
            \mathchoice{%
                \@pac@Small@ghost \textfont {\@pac@Small@textfont@thickness}{\@pac@Small@textfont@eye}%
            }{%
                \@pac@Small@ghost \textfont {\@pac@Small@textfont@thickness}{\@pac@Small@textfont@eye}%
            }{%
                \@pac@Small@ghost \scriptfont {\@pac@Small@scriptfont@thickness}{\@pac@Small@scriptfont@eye}%
            }{%
                \@pac@Small@ghost \scriptscriptfont {\@pac@Small@sscriptfont@thickness}{\@pac@Small@sscriptfont@eye}%
            }%
        }%
    }% \displaylimits % as per default
}

% scaling backend
\DeclareRobustCommand\bigop[2][1]{%
  \mathop{\vphantom{\sum}\mathpalette\bigop@{{#1}{#2}}}\slimits@
}
\newcommand{\bigop@}[2]{\bigop@@#1#2}
\newcommand{\bigop@@}[3]{%
  \vcenter{%
    \sbox\z@{$#1\sum$}%
    \hbox{\resizebox{\ifx#1\displaystyle#2\fi\dimexpr\ht\z@+\dp\z@}{!}{$\m@th#3$}}%
  }%
}

% User-level commands.
\newcommand*\pacman{
    \@ifstar
        {\@pac@eye@false \@pac@mathman}%
        {\@pac@eye@true  \@pac@mathman}%
}
\newcommand*\bigpacman{
    \@ifstar
        {\DOTSB\bigop[0.77]{\@pac@eye@false \@pac@mathman}}%
        {\DOTSB\bigop[0.77]{\@pac@eye@true  \@pac@mathman}}%
}

\newcommand*\ghost{
    \@ifstar
        {\@pac@eye@false \@pac@mathghost}%
        {\@pac@eye@true  \@pac@mathghost}%
}
\newcommand*\bigghost{
    \@ifstar
        {\DOTSB\bigop[0.77]{\@pac@eye@false \@pac@mathghost}}%
        {\DOTSB\bigop[0.77]{\@pac@eye@true  \@pac@mathghost}}%
}
\makeatother
